1. switch
2. struct ref add to state